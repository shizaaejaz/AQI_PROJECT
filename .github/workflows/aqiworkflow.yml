name: AQI Automation Pipeline

# When to run
on:
  schedule:
    - cron: "0 * * * *"   # Run every hour; change cron as needed
  workflow_dispatch:       # Allows manual trigger

jobs:
  run-aqi-and-commit:
    runs-on: ubuntu-latest
    env:
      HOPSWORKS_API_KEY: ${{ secrets.HOPSWORKS_API_KEY }}

    steps:
      # 1️⃣ Checkout your repo
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ Setup Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      # 3️⃣ Install dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4️⃣ Run AQI pipeline
      - name: Run KHI_AQI.py
        run: python KHI_AQI.py

      # 5️⃣ Commit and push updated CSVs
      - name: Commit and push CSVs
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add karachi_weather_5hourly.csv latest_predictions.csv
          git diff --cached --quiet || git commit -m "Automated AQI update"
          git push origin HEAD:main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          
